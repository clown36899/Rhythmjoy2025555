
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <base href="/" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    
    <!-- PWA ì„¤ì • - ë™ì  manifest -->
    <link rel="manifest" id="manifest-placeholder" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="ë¹Œë³´ë“œ" />
    <meta name="theme-color" content="#000000" />
    
    <!-- ë™ì  Manifest ìƒì„± -->
    <script>
      (function() {
        const currentPath = window.location.pathname;
        const baseUrl = window.location.origin;
        
        // ë¹Œë³´ë“œ í˜ì´ì§€ë©´ ì„œë²„ì—ì„œ ë™ì  manifest ê°€ì ¸ì˜¤ê¸°
        if (currentPath.includes('/billboard/')) {
          const userId = currentPath.split('/billboard/')[1];
          if (userId) {
            // í”„ë¡œë•ì…˜: Netlify Functions, ê°œë°œ: Auth Server
            const manifestUrl = window.location.hostname === 'localhost'
              ? 'http://localhost:3001/api/billboard-manifest?userId=' + userId
              : baseUrl + '/.netlify/functions/billboard-manifest?userId=' + userId;
            document.getElementById('manifest-placeholder').setAttribute('href', manifestUrl);
            return;
          }
        }
        
        // ê¸°ë³¸ manifest (ë¹Œë³´ë“œê°€ ì•„ë‹Œ ê²½ìš°)
        const manifestData = {
          name: 'ê´‘ê³ íŒ',
          short_name: 'ê´‘ê³ íŒ',
          description: 'ì´ë²¤íŠ¸ ë¹Œë³´ë“œ ë””ìŠ¤í”Œë ˆì´',
          start_url: baseUrl + currentPath,
          display: 'fullscreen',
          background_color: '#000000',
          theme_color: '#000000',
          orientation: 'any',
          scope: baseUrl + '/',
          icons: [
            {
              src: baseUrl + '/icon-192.png',
              sizes: '192x192',
              type: 'image/png',
              purpose: 'any'
            },
            {
              src: baseUrl + '/icon-512.png',
              sizes: '512x512',
              type: 'image/png',
              purpose: 'any maskable'
            }
          ]
        };
        
        const manifestBlob = new Blob([JSON.stringify(manifestData)], { type: 'application/json' });
        const manifestURL = URL.createObjectURL(manifestBlob);
        document.getElementById('manifest-placeholder').setAttribute('href', manifestURL);
      })();
      
      // ìœ íŠœë¸Œ iframe ì½˜ì†” ì—ëŸ¬ í•„í„°ë§ (ê¸°ëŠ¥ì—ëŠ” ì˜í–¥ ì—†ìŒ)
      const originalError = console.error;
      console.error = function(...args) {
        const errorMsg = args[0]?.toString() || '';
        if (errorMsg.includes('Unknown yt page')) {
          return; // ìœ íŠœë¸Œ ë‚´ë¶€ ì—ëŸ¬ ë¬´ì‹œ
        }
        originalError.apply(console, args);
      };
      
      // ğŸ¬ VP9 ì½”ë± ì°¨ë‹¨ â†’ H.264 ê°•ì œ (Android TV í•˜ë“œì›¨ì–´ ê°€ì† ìµœì í™”)
      (function() {
        if (typeof MediaSource !== 'undefined' && MediaSource.isTypeSupported) {
          const originalIsTypeSupported = MediaSource.isTypeSupported.bind(MediaSource);
          
          MediaSource.isTypeSupported = function(type) {
            // VP9 ì½”ë± ì°¨ë‹¨ â†’ YouTubeê°€ H.264ë¡œ í´ë°±
            if (type && (type.includes('vp9') || type.includes('vp09') || type.includes('vp8'))) {
              console.log('[ì½”ë± ìµœì í™”] VP9/VP8 ì°¨ë‹¨ â†’ H.264 ì„ íƒ:', type);
              return false;
            }
            return originalIsTypeSupported(type);
          };
          
          console.log('[ì½”ë± ìµœì í™”] H.264 ê°•ì œ ëª¨ë“œ í™œì„±í™” (Android TV ìµœì í™”)');
        }
      })();
    </script>
    
    <title>ê´‘ê³ íŒ - Discover Amazing Events</title>
    <meta name="description" content="Find concerts, workshops, conferences and more happening near you. Create and discover amazing events with ê´‘ê³ íŒ.">
    <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.5.0/remixicon.min.css">
  
  <!-- Kakao Map SDK - /social í˜ì´ì§€ì—ì„œë§Œ ë™ì  ë¡œë“œ -->
  <script>
    (function() {
      // /social í˜ì´ì§€ì—ì„œë§Œ ì¹´ì¹´ì˜¤ ì§€ë„ SDK ë¡œë“œ
      if (window.location.pathname.startsWith('/social')) {
        const script = document.createElement('script');
        script.type = 'text/javascript';
        script.src = 'https://dapi.kakao.com/v2/maps/sdk.js?appkey=4f36c4e35ab80c9bff7850e63341daa6&libraries=clusterer&autoload=false';
        script.async = false; // ë™ê¸° ë¡œë“œë¡œ ì§€ë„ ì´ˆê¸°í™” ë³´ì¥
        document.head.appendChild(script);
      }
    })();
  </script>
  
  <style>
    /* CSS ë¡œë“œ ì „ ê¹¨ì§„ ë ˆì´ì•„ì›ƒ ë°©ì§€ */
    body { visibility: hidden; }
    body.loaded { visibility: visible; }
  </style>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
    
    <!-- PWA Service Worker ë“±ë¡ -->
    <script>
      if ('serviceWorker' in navigator) {
        // ë¹Œë³´ë“œ í˜ì´ì§€ì—ì„œë§Œ ì„œë¹„ìŠ¤ ì›Œì»¤ ë“±ë¡
        if (window.location.pathname.includes('/billboard/')) {
          window.addEventListener('load', function() {
            navigator.serviceWorker.register('/service-worker.js')
              .then(function(registration) {
                console.log('Service Worker ë“±ë¡ ì„±ê³µ:', registration.scope);
              })
              .catch(function(error) {
                console.log('Service Worker ë“±ë¡ ì‹¤íŒ¨:', error);
              });
          });
        }
      }
    </script>
  </body>
</html>
