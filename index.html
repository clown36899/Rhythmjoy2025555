<!doctype html>
<html lang="ko">

<head>
  <meta charset="UTF-8" />
  <meta name="google" content="notranslate" />
  <base href="/" />
  <link rel="icon" type="image/svg+xml" href="/vite.svg" />
  <meta name="viewport"
    content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover, shrink-to-fit=no" />
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <script>
    (function () {
      var savedTheme = localStorage.getItem('theme') || 'dark';
      document.documentElement.setAttribute('data-theme', savedTheme);
      // Removed hardcoded theme-color meta tag from HTML, let script handle it
      var themeColor = savedTheme === 'dark' ? '#000000' : '#f9fafb';
      var metaThemeColor = document.querySelector('meta[name="theme-color"]');
      if (metaThemeColor) {
        metaThemeColor.setAttribute('content', themeColor);
      } else {
        var meta = document.createElement('meta');
        meta.name = 'theme-color';
        meta.content = themeColor;
        document.getElementsByTagName('head')[0].appendChild(meta);
      }
    })();
  </script>

  <!-- PWA ì„¤ì • - ë™ì  manifest -->
  <link rel="manifest" id="manifest-placeholder" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="ë¹Œë³´ë“œ" />
  <!-- Dynamic theme-color handled by script above -->
  <!-- Open Graph / Facebook -->
  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://swingenjoy.com/" />
  <meta property="og:title" content="ëŒ„ìŠ¤ë¹Œë³´ë“œ - ìŠ¤ìœ™ ëŒ„ìŠ¤ ì´ë²¤íŠ¸ ê³µìœ  í”Œë«í¼" />
  <meta property="og:description" content="ì „êµ­ì˜ ë‹¤ì±„ë¡œìš´ ìŠ¤ìœ™ ëŒ„ìŠ¤ ì†Œì…œ, ê°•ìŠµ, íŒŒí‹° ì •ë³´ë¥¼ í•œëˆˆì— í™•ì¸í•˜ê³  ê³µìœ í•˜ì„¸ìš”." />
  <meta property="og:image" content="https://swingenjoy.com/kakao-share-card.png" />

  <!-- Twitter -->
  <meta property="twitter:card" content="summary_large_image" />
  <meta property="twitter:url" content="https://swingenjoy.com/" />
  <meta property="twitter:title" content="ëŒ„ìŠ¤ë¹Œë³´ë“œ - ìŠ¤ìœ™ ëŒ„ìŠ¤ ì´ë²¤íŠ¸ ê³µìœ  í”Œë«í¼" />
  <meta property="twitter:description" content="ì „êµ­ì˜ ë‹¤ì±„ë¡œìš´ ìŠ¤ìœ™ ëŒ„ìŠ¤ ì†Œì…œ, ê°•ìŠµ, íŒŒí‹° ì •ë³´ë¥¼ í•œëˆˆì— í™•ì¸í•˜ê³  ê³µìœ í•˜ì„¸ìš”." />
  <meta property="twitter:image" content="https://swingenjoy.com/kakao-share-card.png" />

  <!-- ë™ì  Manifest ìƒì„± -->
  <script>
    (function () {
      const currentPath = window.location.pathname;
      const baseUrl = window.location.origin;

      // ë¹Œë³´ë“œ í˜ì´ì§€ë©´ ì„œë²„ì—ì„œ ë™ì  manifest ê°€ì ¸ì˜¤ê¸°
      if (currentPath.includes('/billboard/')) {
        const userId = currentPath.split('/billboard/')[1];
        if (userId) {
          // í”„ë¡œë•ì…˜: Netlify Functions, ê°œë°œ: Auth Server
          const manifestUrl = window.location.hostname === 'localhost'
            ? 'http://localhost:3001/api/billboard-manifest?userId=' + userId
            : baseUrl + '/.netlify/functions/billboard-manifest?userId=' + userId;
          document.getElementById('manifest-placeholder').setAttribute('href', manifestUrl);
          return;
        }
      }

      // ê¸°ë³¸ manifest (ë¹Œë³´ë“œê°€ ì•„ë‹Œ ê²½ìš°)
      document.getElementById('manifest-placeholder').setAttribute('href', '/manifest.json');
    })();

    // PWA ì„¤ì¹˜ í”„ë¡¬í”„íŠ¸ ì¡°ê¸° ìº¡ì²˜
    window.deferredPrompt = null;
    window.addEventListener('beforeinstallprompt', (e) => {
      console.log('ğŸš€ [index.html] beforeinstallprompt captured early');
      e.preventDefault();
      window.deferredPrompt = e;
      // React ì»¨í…ìŠ¤íŠ¸ê°€ ë¡œë“œëœ í›„ì—ë„ ë°›ì„ ìˆ˜ ìˆë„ë¡ ì»¤ìŠ¤í…€ ì´ë²¤íŠ¸ ë°œì†¡
      window.dispatchEvent(new CustomEvent('pwaPromptReady', { detail: e }));
    });

    // ìœ íŠœë¸Œ iframe ì½˜ì†” ì—ëŸ¬ í•„í„°ë§ (ê¸°ëŠ¥ì—ëŠ” ì˜í–¥ ì—†ìŒ)
    const originalError = console.error;
    console.error = function (...args) {
      const errorMsg = args[0]?.toString() || '';
      // YouTube ë‚´ë¶€ ì˜¤ë¥˜ ë¬´ì‹œ
      if (errorMsg.includes('Unknown yt page')) {
        return;
      }
      // postMessage cross-origin ì˜¤ë¥˜ ë¬´ì‹œ (YouTube iframe ë‚´ë¶€ í†µì‹ )
      if (errorMsg.includes('postMessage') || errorMsg.includes('DOMWindow')) {
        return;
      }
      originalError.apply(console, args);
    };
  </script>

  <title>ëŒ„ìŠ¤ë¹Œë³´ë“œ</title>
  <meta name="description"
    content="Find concerts, workshops, conferences and more happening near you. Create and discover amazing events with ê´‘ê³ íŒ.">

  <!-- DNS Prefetch for external domains -->
  <link rel="dns-prefetch" href="https://mkoryudscamnopvxdelk.supabase.co">
  <link rel="dns-prefetch" href="https://cdnjs.cloudflare.com">
  <link rel="dns-prefetch" href="https://fonts.googleapis.com">
  <link rel="dns-prefetch" href="https://fonts.gstatic.com">

  <!-- Preconnect for critical resources -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

  <!-- Font optimization with preload -->
  <link rel="preload" href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" as="style"
    onload="this.onload=null;this.rel='stylesheet'">
  <noscript>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap">
  </noscript>

  <!-- Icon fonts with async loading -->
  <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" as="style"
    onload="this.onload=null;this.rel='stylesheet'">
  <noscript>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  </noscript>

  <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.5.0/remixicon.min.css" as="style"
    onload="this.onload=null;this.rel='stylesheet'">
  <noscript>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.5.0/remixicon.min.css">
  </noscript>

  <!-- Pretendard Web Font -->
  <link rel="stylesheet"
    href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />

  <!-- Kakao Map SDK - í•­ìƒ ë¡œë“œ -->
  <script type="text/javascript"
    src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=4f36c4e35ab80c9bff7850e63341daa6&libraries=clusterer&autoload=false"></script>
  <!-- Kakao JS SDK for Sharing -->
  <script src="https://t1.kakaocdn.net/kakao_js_sdk/2.7.4/kakao.min.js"></script>

  <style>
    /* Essential Styles for initial load */
    @keyframes spin {
      from {
        transform: rotate(0deg);
      }

      to {
        transform: rotate(360deg);
      }
    }

    /* Google Translate styles - Theme aware */
    .goog-te-gadget-simple {
      background-color: transparent !important;
      border: none !important;
      padding: 4px 8px !important;
      color: var(--text-primary) !important;
    }

    .goog-te-gadget-icon {
      display: none !important;
    }

    #goog-gt-tt,
    .goog-te-banner-frame,
    .goog-te-balloon-frame {
      display: none !important;
    }

    body {
      top: 0 !important;
    }

    body.translated-ltr,
    body.translated-rtl {
      top: 0 !important;
    }

    .skiptranslate iframe,
    iframe.VIpgJd-ZVi9od-ORHb-OEVmcd,
    iframe.skiptranslate {
      display: none !important;
      visibility: hidden !important;
    }

    body>.skiptranslate {
      display: none !important;
    }

    /* Fix backdrop-filter compatibility */
    [data-theme="light"] .global-header {
      background-color: var(--header-bg-color);
    }

    /* SW Update Bottom Sheet */
    #sw-update-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.5);
      z-index: 2147483647;
      display: flex;
      align-items: flex-end;
      justify-content: center;
      -webkit-backdrop-filter: blur(4px);
      backdrop-filter: blur(4px);
    }

    .sw-update-sheet {
      width: 100%;
      max-width: 420px;
      background: #1a1a2e;
      border-radius: 20px 20px 0 0;
      padding: 12px 24px calc(env(safe-area-inset-bottom, 16px) + 16px);
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      transform: translateY(0);
      transition: transform 0.3s ease;
    }

    .sw-update-handle {
      width: 36px;
      height: 4px;
      border-radius: 2px;
      background: rgba(255, 255, 255, 0.2);
      margin-bottom: 8px;
    }

    .sw-update-icon {
      font-size: 40px;
      line-height: 1;
    }

    .sw-update-title {
      font-family: Pretendard, sans-serif;
      font-size: 18px;
      font-weight: 700;
      color: #fff;
    }

    .sw-update-desc {
      font-family: Pretendard, sans-serif;
      font-size: 14px;
      color: rgba(255, 255, 255, 0.6);
      margin-bottom: 8px;
    }

    .sw-update-btn {
      width: 100%;
      padding: 14px;
      border: none;
      border-radius: 12px;
      background: linear-gradient(135deg, #6366f1, #4f46e5);
      color: #fff;
      font-family: Pretendard, sans-serif;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      -webkit-tap-highlight-color: transparent;
    }

    .sw-update-btn:active {
      opacity: 0.85;
      transform: scale(0.98);
    }

    .sw-update-later {
      width: 100%;
      padding: 12px;
      border: none;
      border-radius: 12px;
      background: transparent;
      color: rgba(255, 255, 255, 0.45);
      font-family: Pretendard, sans-serif;
      font-size: 14px;
      cursor: pointer;
      -webkit-tap-highlight-color: transparent;
    }
  </style>
</head>

<body style="margin: 0; padding: 0;">
  <div id="google_translate_element" style="display: none;"></div>

  <div id="root"></div>
  <script type="module" src="/src/main.tsx"></script>

  <!-- Google Translate Script -->
  <script type="text/javascript">
    function googleTranslateElementInit() {
      new google.translate.TranslateElement(
        {
          pageLanguage: 'ko',
          includedLanguages: 'en',
          autoDisplay: false
          // layout ì œê±°: HORIZONTALì´ ê¸°ë³¸ê°’ì´ë©° .goog-te-combo ìš”ì†Œë¥¼ ìƒì„±í•¨
        },
        'google_translate_element'
      );
    }

    // ì–¸ì–´ ë³€ê²½ í•¨ìˆ˜
    function changeLanguage(lang) {
      const select = document.querySelector('.goog-te-combo');

      if (select) {
        // í•œêµ­ì–´ ì„ íƒ ì‹œ ë²ˆì—­ ë„ê¸° (êµ¬ê¸€ ë²ˆì—­ X ë²„íŠ¼ê³¼ ë™ì¼í•œ ë°©ì‹)
        if (lang === 'ko') {
          // googtrans ì¿ í‚¤ ì‚­ì œ (ëª¨ë“  ê²½ë¡œì—ì„œ)
          document.cookie = 'googtrans=; path=/; expires=Thu, 01 Jan 1970 00:00:00 UTC; domain=' + window.location.hostname;
          document.cookie = 'googtrans=; path=/; expires=Thu, 01 Jan 1970 00:00:00 UTC;';
          // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨í•˜ì—¬ ì›ë³¸ ì–¸ì–´ë¡œ ë³µì›
          window.location.reload();
        } else {
          select.value = lang;
          select.dispatchEvent(new Event('change'));

          // React ì»´í¬ë„ŒíŠ¸ì— ì–¸ì–´ ë³€ê²½ ì•Œë¦¼
          window.dispatchEvent(new CustomEvent('languageChanged', { detail: { lang } }));
        }
      } else {
        // Google Translateê°€ ì•„ì§ ë¡œë“œë˜ì§€ ì•Šì•˜ìœ¼ë©´ ì¬ì‹œë„
        setTimeout(() => changeLanguage(lang), 500);
      }
    }

    // ë©”ë‰´ ì™¸ë¶€ í´ë¦­ ê°ì§€ ì œê±° (í† ê¸€ ë°©ì‹ìœ¼ë¡œ ë³€ê²½ë¨)

  </script>
  <script type="text/javascript"
    src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

  <!-- PWA Service Worker ë“±ë¡ + ë²„ì „ ì²´í¬ -->
  <script>
    if ('serviceWorker' in navigator) {
      // í˜ì´ì§€ ë¡œë“œ ì‹œì ì— ê¸°ì¡´ ì»¨íŠ¸ë¡¤ëŸ¬ ì¡´ì¬ ì—¬ë¶€ ê¸°ë¡ (ìµœì´ˆ ì„¤ì¹˜ vs ì—…ë°ì´íŠ¸ íŒë³„)
      var hadController = !!navigator.serviceWorker.controller;

      window.addEventListener('load', function () {
        var swUrl = '/service-worker.js?v=20260213_v42';
        navigator.serviceWorker.register(swUrl)
          .then(function (reg) {
            console.log('[PWA] Service Worker registered (v40)');

            // SW ì—…ë°ì´íŠ¸ ê°ì§€: ìƒˆ SWê°€ ì„¤ì¹˜ë˜ë©´ ì‚¬ìš©ìì—ê²Œ ì•Œë¦¼
            reg.addEventListener('updatefound', function () {
              var newWorker = reg.installing;
              if (!newWorker) return;
              newWorker.addEventListener('statechange', function () {
                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                  showUpdateToast(reg);
                }
              });
            });

            // ì£¼ê¸°ì  SW ì—…ë°ì´íŠ¸ ì²´í¬ (5ë¶„ë§ˆë‹¤)
            setInterval(function () { reg.update(); }, 5 * 60 * 1000);
          })
          .catch(function (err) { console.error('[PWA] Service Worker failed:', err); });

        // SWê°€ SW_UPDATED ë©”ì‹œì§€ë¥¼ ë³´ë‚´ë©´ ìë™ ë¦¬ë¡œë“œ (ë°°í¬ í›„ chunk ë¶ˆì¼ì¹˜ ë°©ì§€)
        navigator.serviceWorker.addEventListener('message', function (event) {
          if (event.data && event.data.type === 'SW_UPDATED') {
            // ìµœì´ˆ ì„¤ì¹˜ ì‹œì—ëŠ” ë¦¬ë¡œë“œ ë¶ˆí•„ìš” (ì´ì „ SWê°€ ì—†ì—ˆìœ¼ë¯€ë¡œ chunk ë¶ˆì¼ì¹˜ ì—†ìŒ)
            if (!hadController) return;
            var lastSwReload = sessionStorage.getItem('sw_reload');
            if (lastSwReload && Date.now() - parseInt(lastSwReload) < 10000) {
              console.warn('[PWA] SW reload loop detected, skipping');
              return;
            }
            // ì¸ì¦ ì½œë°± ì¤‘(/auth/) ë˜ëŠ” URLì— ì¸ì¦ íŒŒë¼ë¯¸í„°ê°€ ìˆì„ ë•ŒëŠ” íë¦„ ë°©í•´ë¥¼ ë§‰ê¸° ìœ„í•´ ìë™ ë¦¬ë¡œë“œ í•˜ì§€ ì•ŠìŒ
            var urlParams = new URLSearchParams(window.location.search);
            var hash = window.location.hash;
            var hasAuthParams = urlParams.has('code') || urlParams.has('error') || hash.includes('access_token=') || hash.includes('refresh_token=');

            if (window.location.pathname.includes('/auth/') || hasAuthParams) {
              console.log('[PWA] Auth in progress or params detected, delaying SW reload');
              return;
            }
            console.log('[PWA] New SW activated, reloading for fresh assets...');
            sessionStorage.setItem('sw_reload', Date.now().toString());
            window.location.reload();
          }
        });

        // ì‚¬ìš©ìê°€ ì—…ë°ì´íŠ¸ ë²„íŠ¼ í´ë¦­ ì‹œ ë¦¬ë¡œë“œ
        navigator.serviceWorker.addEventListener('controllerchange', function () {
          if (window.__SW_UPDATING) {
            // ì¸ì¦ ì½œë°± ì¤‘ ë˜ëŠ” íŒŒë¼ë¯¸í„° ê°ì§€ ì‹œ ë¦¬ë¡œë“œ ë°©ì–´
            var urlParams = new URLSearchParams(window.location.search);
            var hash = window.location.hash;
            var hasAuthParams = urlParams.has('code') || urlParams.has('error') || hash.includes('access_token=') || hash.includes('refresh_token=');

            if (window.location.pathname.includes('/auth/') || hasAuthParams) return;
            window.location.reload();
          }
        });
      });
    }

    // version.json í´ë§: ë°°í¬ ê°ì§€ (3ë¶„ë§ˆë‹¤)
    (function () {
      var currentBuild = '__BUILD_TIME__';
      if (!currentBuild || currentBuild === '__BUILD_' + 'TIME__') return; // dev ëª¨ë“œ ë¬´ì‹œ

      setInterval(function () {
        fetch('/version.json?t=' + Date.now())
          .then(function (r) { return r.json(); })
          .then(function (data) {
            if (data.buildTime && data.buildTime !== currentBuild) {
              console.log('[Version] New build detected:', data.buildTime);
              // SW ì—…ë°ì´íŠ¸ íŠ¸ë¦¬ê±°
              if (navigator.serviceWorker && navigator.serviceWorker.controller) {
                navigator.serviceWorker.getRegistration().then(function (reg) {
                  if (reg) reg.update();
                });
              } else {
                showUpdateToast(null);
              }
            }
          })
          .catch(function () { /* ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ë¬´ì‹œ */ });
      }, 3 * 60 * 1000);
    })();

    // ì—…ë°ì´íŠ¸ ë°”í…€ì‹œíŠ¸
    function showUpdateToast(reg) {
      if (document.getElementById('sw-update-overlay')) return;
      window.__SW_REG = reg;

      var overlay = document.createElement('div');
      overlay.id = 'sw-update-overlay';
      overlay.innerHTML =
        '<div class="sw-update-sheet">' +
        '<div class="sw-update-handle"></div>' +
        '<div class="sw-update-icon">&#x1f680;</div>' +
        '<div class="sw-update-title">ìƒˆ ë²„ì „ì´ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤</div>' +
        '<div class="sw-update-desc">ë” ë‚˜ì€ ê²½í—˜ì„ ìœ„í•´ ì—…ë°ì´íŠ¸í•´ ì£¼ì„¸ìš”.</div>' +
        '<button class="sw-update-btn" onclick="applyUpdate()">ì§€ê¸ˆ ì—…ë°ì´íŠ¸</button>' +
        '<button class="sw-update-later" onclick="dismissUpdate()">ë‚˜ì¤‘ì—</button>' +
        '</div>';
      document.body.appendChild(overlay);

      // ë°°ê²½ íƒ­í•˜ë©´ ë‹«ê¸°
      overlay.addEventListener('click', function (e) {
        if (e.target === overlay) dismissUpdate();
      });
    }

    function dismissUpdate() {
      var el = document.getElementById('sw-update-overlay');
      if (el) {
        el.querySelector('.sw-update-sheet').style.transform = 'translateY(100%)';
        setTimeout(function () { el.remove(); }, 300);
      }
    }

    function applyUpdate() {
      window.__SW_UPDATING = true;
      var reg = window.__SW_REG;
      if (reg && reg.waiting) {
        reg.waiting.postMessage({ type: 'SKIP_WAITING' });
      } else {
        window.location.reload();
      }
    }
  </script>
</body>

</html>